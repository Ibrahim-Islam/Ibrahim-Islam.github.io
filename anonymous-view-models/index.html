<!DOCTYPE html>
<html>

	<head>

		
		<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		
		<title>Anonymous View Models</title>
		<meta name="description" content="" />
		
		<link rel="stylesheet" type="text/css" href="../assets/css/style.css" />
		<link rel="stylesheet" type="text/css" href="../assets/css/normalize.css" />

		<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,600,700,800|Exo+2:400,100,200,300,500,600,700,800' rel='stylesheet' type='text/css'>
		
		<meta name="HandheldFriendly" content="True" />
		<meta name="MobileOptimized" content="320" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link href="../assets/css/prism.css" rel="stylesheet"></link> 
		<meta name="generator" content="Ghost 0.5" />
<link rel="alternate" type="application/rss+xml" title="" href="../rss/index.html">
<link rel="canonical" href="http://my-ghost-blog.com/anonymous-view-models/" />

	</head>

	<body class="post-template tag-asp-net-mvc">

		<div class="wrapper_pixel">

			

<div role='banner' class="header_pixel">

	<div class="menu_list">
		<a class="menu_item" href="http://bd.linkedin.com/in/mdibrahimislam/">LinkedIn</a>
		<a class="menu_item" href="http://stackoverflow.com/users/1565402/md-lbrahim">StackOverflow</a>
		<a class="menu_item" href="http://forums.asp.net/members/IbrahimIslam.aspx">ASP.NET</a>
		<a class="menu_item" href="https://github.com/Ibrahim-Islam">GitHub</a>
		<a class="menu_item" href="mailto:ibrahim.islam@live.com">Email</a>
	</div>

	<a class="" href="../index.html"><img class="cover_pixel" src="../content/images/2014/Aug/ACGTZvx.jpg" alt="" /></a>

	<h1 class="blogtitle_pixel">

		<a title="" href='http://my-ghost-blog.com'>

			

		</a>

	</h1>

	<p class="blogdescription_pixel">

		<a title="" href='http://my-ghost-blog.com'>

			C# | ASP.NET MVC | JavaScript |ORM | API

		</a>

	</p>

</div>

<main class="main_pixel post" role="main">

	
		
		<div id="trampezium"></div>

		<article class="article_pixel" role="article" itemscope itemtype="http://schema.org/Article" style="display:table;">
		
			<header class="postheader_pixel">

				<time class="date_pixel" datetime="2014-07-21" itemprop="datePublished">

					<span class="icon-clock"></span>Monday 21 Jul 2014

				</time>

				<h1 class="posttitle_pixel" itemprop="headline">

					Anonymous View Models

				</h1>
				
			</header>

			<div class="postcontent_pixel" itemprop="articleBody">

				<p>Generally, we make a Typed ViewModel to be sent to the View in ASP.NET MVC. This means we might need to make more than 1 ViewModel for each View e.g. Edit, Details, etc. That could sum up to a lot of classes in a project. <br />
Due to this reason, I wanted to be able to return an anonymous object I have in my Action to the View. Like below:  </p>

<pre><code class=" language-csharp">public ActionResult GetCustomer(int id)  
{
    var customer = db.Customers
                    .Where(c =&gt; c.Id == id)
                    .Select(c =&gt; new { Name = c.FullName })
                    .Single();
    return View(customer);
}
</code></pre>

<p>If <code>@Model</code> is rendered in <code>Index.cshtml</code> View, you will see its contents.  </p>

<pre><code class=" language-csharp">{ Name = Ibrahim }
</code></pre>

<p>But as soon you would want to get inside the object e.g. <code>@Model.Name</code> you will encounter an error saying <code>Object does not contain a definition for Name</code>. This happens because Anonymous classes by default are <code>internal</code> meaning only accessible within the assembly they were created in and you would think that our <code>index.cshtml</code> is part of that same assembly <strong>but behind the scenes all Views are compiled in a seperate assembly</strong>.</p>

<p>So, to get the flexibilty of anonymous objects while being able to traverse it in a View we need to make use of <code>dynamic</code> and <code>ExpandoObject</code> both <strong>only available from 4.0 and onwards</strong>. In short:</p>

<blockquote>
  <p><code>dynamic</code> tells .NET to resolve an object's members at runtime and <code>ExpandoObject</code> allows for addition and removal of members at runtime.</p>
</blockquote>

<p>The idea is to tell the View to expect a <code>dynamic</code> object while we convert our anonymous object to an <code>ExpandoObject</code> which can make accross the assembly boundary. Below is a sample of one such extension method:  </p>

<pre><code class=" language-csharp">public static dynamic ToDynamic(this object AnonymousObject)  
{
  IDictionary&lt;string, Object&gt; expando = new ExpandoObject();
  foreach (var property in AnonymousObject.GetType().GetProperties())
  {
      expando[property.Name] = property.GetValue(AnonymousObject);
  }
  return (dynamic)expando;
}
</code></pre>

<p>Its usage can be as simple as this:  </p>

<pre><code class=" language-csharp">public ActionResult Index(int id)  
{
    var customer = db.Customers
                    .Where(c =&gt; c.Id == id)
                    .Select(c =&gt; new { Name = c.FullName })
                    .Single();
    return View(customer.ToDynamic());
}
</code></pre>

			</div>

			
			
				<div class="posttags_pixel">

					<p><span class="icon-tag"></span> <a href="../tag/asp-net-mvc/index.html">asp.net-mvc</a></p>

				</div>

			

			

		</article>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'dev-ibrahim'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	

	

</main>

<footer class="footer_pixel">

	<p class="subscribe_pixel"><a class="icon-rss" target="_blank" href="../rss/index.html">

	</a></p>

	<div class="footertext_pixel">

		<p>All content copyright <a href="../index.html"></a> &copy; 2013 &bull; All rights reserved.</p>

	</div>

	<div class="footertext_pixel">

		<p>Proudly published with <a class="icon-ghost" href="http://tryghost.org" target="_blank">Ghost</a></p>
		<p>Theme: <a class="icon-github-circled" href="https://github.com/Skepton/Pixelpusher"></a></p>

	</div>

</footer>

		</div>

		<script src="../public/jquery.js"></script>
		<script src="../assets/js/prism.js"></script>
		<script src="../assets/js/fittext.js"></script>

		

		

		<script type="text/javascript">

			$(window).load(function(){

				if($('.postcontent_pixel p').eq(0).find('img').length){

					$('.postcontent_pixel p').eq(0).find('img').hide();

				}

			});

			$(document).ready(function(){

				if($('.postcontent_pixel p').eq(0).find('img').length){

					var source = $('.postcontent_pixel p').eq(0).find('img').attr('src');

					if($('.cover_pixel').length <= 0){

						$('.header_pixel').append('<img class="cover_pixel" src="http://127.0.0.1:2368/anonymous-view-models/'+source+'" alt="header">');

					}else{

						$('.cover_pixel').attr('src', source);

					}

					$('.postcontent_pixel p').eq(0).remove();

				}

				$('.blogdescription_pixel').remove();
				$('.blogtitle_pixel a').remove();

				$(".article_pixel img").load(function() {

					$(window).trigger('resize');
				  
				}).each(function() {

				  if(this.complete) $(this).load();

				});

				(function($) {
					// Responsive videos
					var all_videos = $( 'iframe[src^="http://player.vimeo.com"], iframe[src^="http://www.youtube.com"], iframe[src^="//www.youtube.com"], object, embed' );

					all_videos.each(function() {
						var el = $(this);

						el
							.attr( 'data-aspectRatio', el.height() / el.width() )
							.attr( 'data-oldWidth', el.attr( 'width' ) );
					} );
					
					$(window)
						.resize( function() {
							all_videos.each( function() {
								var el = $(this),
									newWidth = el.parents( '.postcontent_pixel' ).innerWidth(),
									oldWidth = el.attr( 'data-oldWidth' );
									el
										.removeAttr( 'height' )
										.removeAttr( 'width' )
										.width( newWidth )
								    		.height( newWidth * el.attr( 'data-aspectRatio' ) );
							} );
						} )
						.resize();
				})(jQuery);

				$(window).trigger('resize');

			});

			$(window).resize(function(){

				if($('.wrapper_pixel').height()<$(window).height()-$('.footer_pixel').height()){

					$('.footer_pixel').css('position','absolute');

				}else{$('.footer_pixel').css('position','relative');}

				$('.cover_pixel').on('load',function(){

					var header_height = $(this).height();
					var parent_height = $('.header_pixel').outerHeight();

					var height_complete = '-'+(header_height-parent_height)/2+'px';

					if((header_height-parent_height)/2 <= 0){height_complete = '0px';}

					$(this).css('margin-top',height_complete);

				}).each(function() {

					if(this.complete) $(this).load();

				});

				$('.postfooter_pixel address').css('height',$('.authorbio_pixel').outerHeight());
				$('.sharepost_pixel').css('height',$('.authorbio_pixel').outerHeight());

				jQuery(".postheader_pixel h1").fitText(1.1, { minFontSize: '40px', maxFontSize: '90px' });

			});

			$(window).scroll(function(){

				if($(this).scrollTop() > 50 && $(window).width() > 500 && $(window).height() > 500){
			
					jQuery(".blogtitle_pixel a").fitText(1.5, { minFontSize: '20px', maxFontSize: '32px' });

					$('.article_pixel').css('margin-top',$('.header_pixel').height()+230);

					$('.header_pixel').addClass('small');

					$('.article_pixel').css('margin-top',$('.header_pixel').height()+230);


				}else if($(this).scrollTop() <= 50){

					jQuery(".blogtitle_pixel a").fitText(1.2, { minFontSize: '20px', maxFontSize: '75px' });

					$('.article_pixel').css('margin-top',0);

					$('.header_pixel').removeClass('small');

				}

			});

		</script>

		

		<script type="text/javascript">

			$(document).ready(function(){

				$(window).trigger('resize');

				$(document).trigger('scroll');

				jQuery(".blogtitle_pixel a").fitText(1.2, { minFontSize: '20px', maxFontSize: '75px' });

			});

		</script>

	</body>
	

</html>