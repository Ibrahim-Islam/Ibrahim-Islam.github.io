<!DOCTYPE html>
<html>

	<head>

		
		<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		
		<title>Cross-Domain With WebAPI</title>
		<meta name="description" content="" />
		
		<link rel="stylesheet" type="text/css" href="../assets/css/style.css" />
		<link rel="stylesheet" type="text/css" href="../assets/css/normalize.css" />

		<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,600,700,800|Exo+2:400,100,200,300,500,600,700,800' rel='stylesheet' type='text/css'>
		
		<meta name="HandheldFriendly" content="True" />
		<meta name="MobileOptimized" content="320" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link href="../assets/css/prism.css" rel="stylesheet"></link> 
		<meta name="generator" content="Ghost 0.5" />
<link rel="alternate" type="application/rss+xml" title="" href="../rss/index.html">
<link rel="canonical" href="http://my-ghost-blog.com/cross-domain-requests-in-webapi/" />

	</head>

	<body class="post-template tag-webapi">

		<div class="wrapper_pixel">

			

<div role='banner' class="header_pixel">

	<div class="menu_list">
		<a class="menu_item" href="http://bd.linkedin.com/in/mdibrahimislam/">LinkedIn</a>
		<a class="menu_item" href="http://stackoverflow.com/users/1565402/md-lbrahim">StackOverflow</a>
		<a class="menu_item" href="http://forums.asp.net/members/IbrahimIslam.aspx">ASP.NET</a>
		<a class="menu_item" href="https://github.com/Ibrahim-Islam">GitHub</a>
		<a class="menu_item" href="mailto:ibrahim.islam@live.com">Email</a>
	</div>

	<a class="" href="../index.html"><img class="cover_pixel" src="../content/images/2014/Aug/ACGTZvx.jpg" alt="" /></a>

	<h1 class="blogtitle_pixel">

		<a title="" href='http://my-ghost-blog.com'>

			

		</a>

	</h1>

	<p class="blogdescription_pixel">

		<a title="" href='http://my-ghost-blog.com'>

			C# | ASP.NET MVC | JavaScript |ORM | API

		</a>

	</p>

</div>

<main class="main_pixel post" role="main">

	
		
		<div id="trampezium"></div>

		<article class="article_pixel" role="article" itemscope itemtype="http://schema.org/Article" style="display:table;">
		
			<header class="postheader_pixel">

				<time class="date_pixel" datetime="2014-08-24" itemprop="datePublished">

					<span class="icon-clock"></span>Sunday 24 Aug 2014

				</time>

				<h1 class="posttitle_pixel" itemprop="headline">

					Cross-Domain With WebAPI

				</h1>
				
			</header>

			<div class="postcontent_pixel" itemprop="articleBody">

				<p>Someday, there will rise a need to develop APIs that can be comsumed by multiple clients i.e. <strong>cross-domain</strong> requests; for example, APIs to be consumed by browser-based client applications e.g. Chrome Extension or an Angular app.</p>

<p>What is <strong>Cross-Domain</strong>?  </p>

<blockquote>
  <p>Cross-Domain HTTP requests are HTTP requests for resources from a different domain than the domain of the resource making the request. <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">[1]</a></p>
</blockquote>

<p>and this is a big deal because <strong>cross-domain</strong> requests are subjected to a browsers' <strong>same-origin</strong> policy:  </p>

<blockquote>
  <p>The same-origin policy means that your JavaScript can only make AJAX calls back to the same origin of the containing Web page (where “origin” is defined as the combination of host name, protocol and port number). <a href="http://msdn.microsoft.com/en-us/magazine/dn532203.aspx">[2]</a></p>
</blockquote>

<p>Then there was <strong>CORS</strong>:  </p>

<blockquote>
  <p>Cross-origin resource sharing (CORS) is a World Wide Web Consortium (W3C) specification that lets JavaScript overcome the same-origin policy security restriction imposed by browsers.</p>
</blockquote>

<p>So, now what happens is that when a browser sees that a cross-domain request is about to happen it will send in additional headers (depending on the type of CORS request) with the request for the server to determine whether the requesting origin has access to it. There are 2 kinds of CORS request: <strong>Simple</strong> and <strong>Preflight</strong>.</p>

<h3 id="simplecorsrequest">Simple CORS Request</h3>

<p>Simple CORS request are when the browser just adds an <code>origin</code> header with the request to identify the requester. If the browser sends a response with the header <code>Allow-Control-Allow-Origin</code> and its value set as <em>*</em> (meaning any origin) or at least the origin value that was sent with the request then it is successful and the requesting data will be present else error. <br />
To summarise following conditions are to be met for a request for a simple cors request:</p>

<ul>
<li><code>GET</code>, <code>HEAD</code> or <code>POST</code></li>
<li>POST's <code>Content-Type</code> set as one of <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, or <code>text/plain</code></li>
<li>No custom headers</li>
</ul>

<h3 id="preflightcorsrequest">Preflight CORS Request</h3>

<p>Applicable when conditions for a Simple CORS request are not met. Preflight CORS requests consist of an additional prior request using <code>OPTIONS</code> method to the server to get access permission before the actual request takes place. So, 2 requests per cross-domain request or each URL.</p>

<h3 id="microsoftaspnetwebapicors">Microsoft.AspNet.WebApi.Cors</h3>

<p>As you might have guessed from the sub-title above, it is a CORS framework for WebAPI widely available through <a href="https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Cors">NuGet</a> to be referenced in your WebAPI application. It is as easy as enabling it on your <code>WebApiConfig.cs</code> file:  </p>

<pre><code class=" language-csharp">public static class WebApiConfig  
{
  public static void Register(HttpConfiguration config)
  {
    // Enable Cors
    config.EnableCors();

    //...Routes
  }
}
</code></pre>

<p>Then decorate whatever controller which you want Cors support like below with whatever config you prefer. The following allows cors for all origins, headers and methods:  </p>

<pre><code class=" language-csharp">[EnableCors(origins: "*", headers: "*", methods: "*")]
public class TestController : ApiController  
{
    [HttpPost]
    public HttpResponseMessage Post()
    { }
}
</code></pre>

<p>More info can be found <a href="http://www.asp.net/web-api/overview/security/enabling-cross-origin-requests-in-web-api">here</a> on how to fully use this tool.</p>

<p>So, you have no worries about making your APIs cross-domain compliant now and have more control over accessibility. But few things to watch out like when making a <code>PUT</code> or <code>DELETE</code> request which is eligible for a Preflight CORS request and uses <code>OPTIONS</code> method (recall from earlier), you might have your controller set to accept only obvious HTTP methods like <code>POST</code> or <code>GET</code> which will fail the request because you had not allowed <code>OPTIONS</code> to get through.</p>

<p>This post is a summary of my learnings when I was stuck with handling cross-domain request (Preflight) in WebAPI. Hope it will help someone and comment below for any help.</p>

			</div>

			
			
				<div class="posttags_pixel">

					<p><span class="icon-tag"></span> <a href="../tag/webapi/index.html"> webapi</a></p>

				</div>

			

			

		</article>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'dev-ibrahim'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	

	

</main>

<footer class="footer_pixel">

	<p class="subscribe_pixel"><a class="icon-rss" target="_blank" href="../rss/index.html">

	</a></p>

	<div class="footertext_pixel">

		<p>All content copyright <a href="../index.html"></a> &copy; 2013 &bull; All rights reserved.</p>

	</div>

	<div class="footertext_pixel">

		<p>Proudly published with <a class="icon-ghost" href="http://tryghost.org" target="_blank">Ghost</a></p>
		<p>Theme: <a class="icon-github-circled" href="https://github.com/Skepton/Pixelpusher"></a></p>

	</div>

</footer>

		</div>

		<script src="../public/jquery.js"></script>
		<script src="../assets/js/prism.js"></script>
		<script src="../assets/js/fittext.js"></script>

		

		

		<script type="text/javascript">

			$(window).load(function(){

				if($('.postcontent_pixel p').eq(0).find('img').length){

					$('.postcontent_pixel p').eq(0).find('img').hide();

				}

			});

			$(document).ready(function(){

				if($('.postcontent_pixel p').eq(0).find('img').length){

					var source = $('.postcontent_pixel p').eq(0).find('img').attr('src');

					if($('.cover_pixel').length <= 0){

						$('.header_pixel').append('<img class="cover_pixel" src="http://127.0.0.1:2368/cross-domain-requests-in-webapi/'+source+'" alt="header">');

					}else{

						$('.cover_pixel').attr('src', source);

					}

					$('.postcontent_pixel p').eq(0).remove();

				}

				$('.blogdescription_pixel').remove();
				$('.blogtitle_pixel a').remove();

				$(".article_pixel img").load(function() {

					$(window).trigger('resize');
				  
				}).each(function() {

				  if(this.complete) $(this).load();

				});

				(function($) {
					// Responsive videos
					var all_videos = $( 'iframe[src^="http://player.vimeo.com"], iframe[src^="http://www.youtube.com"], iframe[src^="//www.youtube.com"], object, embed' );

					all_videos.each(function() {
						var el = $(this);

						el
							.attr( 'data-aspectRatio', el.height() / el.width() )
							.attr( 'data-oldWidth', el.attr( 'width' ) );
					} );
					
					$(window)
						.resize( function() {
							all_videos.each( function() {
								var el = $(this),
									newWidth = el.parents( '.postcontent_pixel' ).innerWidth(),
									oldWidth = el.attr( 'data-oldWidth' );
									el
										.removeAttr( 'height' )
										.removeAttr( 'width' )
										.width( newWidth )
								    		.height( newWidth * el.attr( 'data-aspectRatio' ) );
							} );
						} )
						.resize();
				})(jQuery);

				$(window).trigger('resize');

			});

			$(window).resize(function(){

				if($('.wrapper_pixel').height()<$(window).height()-$('.footer_pixel').height()){

					$('.footer_pixel').css('position','absolute');

				}else{$('.footer_pixel').css('position','relative');}

				$('.cover_pixel').on('load',function(){

					var header_height = $(this).height();
					var parent_height = $('.header_pixel').outerHeight();

					var height_complete = '-'+(header_height-parent_height)/2+'px';

					if((header_height-parent_height)/2 <= 0){height_complete = '0px';}

					$(this).css('margin-top',height_complete);

				}).each(function() {

					if(this.complete) $(this).load();

				});

				$('.postfooter_pixel address').css('height',$('.authorbio_pixel').outerHeight());
				$('.sharepost_pixel').css('height',$('.authorbio_pixel').outerHeight());

				jQuery(".postheader_pixel h1").fitText(1.1, { minFontSize: '40px', maxFontSize: '90px' });

			});

			$(window).scroll(function(){

				if($(this).scrollTop() > 50 && $(window).width() > 500 && $(window).height() > 500){
			
					jQuery(".blogtitle_pixel a").fitText(1.5, { minFontSize: '20px', maxFontSize: '32px' });

					$('.article_pixel').css('margin-top',$('.header_pixel').height()+230);

					$('.header_pixel').addClass('small');

					$('.article_pixel').css('margin-top',$('.header_pixel').height()+230);


				}else if($(this).scrollTop() <= 50){

					jQuery(".blogtitle_pixel a").fitText(1.2, { minFontSize: '20px', maxFontSize: '75px' });

					$('.article_pixel').css('margin-top',0);

					$('.header_pixel').removeClass('small');

				}

			});

		</script>

		

		<script type="text/javascript">

			$(document).ready(function(){

				$(window).trigger('resize');

				$(document).trigger('scroll');

				jQuery(".blogtitle_pixel a").fitText(1.2, { minFontSize: '20px', maxFontSize: '75px' });

			});

		</script>

	</body>
	

</html>