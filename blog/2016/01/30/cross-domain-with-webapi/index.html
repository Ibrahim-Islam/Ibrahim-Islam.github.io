
<!DOCTYPE HTML>
<html>
<head>
	<meta name="google-site-verification" content="PtdF5OOxCI6ezB1LjPUOPufeuwf7psx98rh36gA88AA" />
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta charset="utf-8">
	<title>Cross-Domain With WebAPI | </title>

	<meta name="author" content="Ibrahim Islam">
	
	<meta name="description" content="How to configure WebAPI to support CORS">

	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link href="/atom.xml" rel="alternate" title="" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400" />
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css" />
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<style type="text/css">
		#imgcontainer {
			margin:2rem auto -2rem auto;
			width:80%;
			max-width:700px;
			display: table;
			margin: 0 auto;
		}

		#imgcontainer img {
		  display: inline-block;
		  vertical-align:middle;
		}

		#imgcontainer a {
		  display: table-cell;
		  text-align: center;
		  width: 16%;
		}
	</style>
</head>


<body class="post-template">
  <main class="content" role="main"><article class="post">
  
	<header class="post-header">
		<a id="blog-logo" href="/"></a>
	</header>
	<span class="post-meta">30 Jan 2016</span>
	<h1 class="post-title">Cross-Domain With WebAPI</h1>

	<section class="post-content">
		<p>Someday, there will rise a need to develop APIs that can be comsumed by multiple clients i.e. <strong>cross-domain</strong> requests; for example, APIs to be consumed by browser-based client applications e.g. Chrome Extension or an Angular app.</p>

<!-- More -->


<p>What is <strong>Cross-Domain</strong>?</p>

<blockquote><p>Cross-Domain HTTP requests are HTTP requests for resources from a different domain than the domain of the resource making the request. <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">[1]</a></p></blockquote>

<p>and this is a big deal because <strong>cross-domain</strong> requests are subjected to a browsers' <strong>same-origin</strong> policy:</p>

<blockquote><p>The same-origin policy means that your JavaScript can only make AJAX calls back to the same origin of the containing Web page (where “origin” is defined as the combination of host name, protocol and port number). <a href="http://msdn.microsoft.com/en-us/magazine/dn532203.aspx">[2]</a></p></blockquote>

<p>Then there was <strong>CORS</strong>:</p>

<blockquote><p>Cross-origin resource sharing (CORS) is a World Wide Web Consortium (W3C) specification that lets JavaScript overcome the same-origin policy security restriction imposed by browsers.</p></blockquote>

<p>So, now what happens is that when a browser sees that a cross-domain request is about to happen it will send in additional headers (depending on the type of CORS request) with the request for the server to determine whether the requesting origin has access to it. There are 2 kinds of CORS request: <strong>Simple</strong> and <strong>Preflight</strong>.</p>

<h3>Simple CORS Request</h3>

<p>Simple CORS request are when the browser just adds an <code>origin</code> header with the request to identify the requester. If the browser sends a response with the header <code>Allow-Control-Allow-Origin</code> and its value set as <em>*</em> (meaning any origin) or at least the origin value that was sent with the request then it is successful and the requesting data will be present else error.
To summarise following conditions are to be met for a request for a simple cors request:</p>

<ul>
<li><code>GET</code>, <code>HEAD</code> or <code>POST</code></li>
<li>POST&rsquo;s <code>Content-Type</code> set as one of <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, or <code>text/plain</code></li>
<li>No custom headers</li>
</ul>


<h3>Preflight CORS Request</h3>

<p>Applicable when conditions for a Simple CORS request are not met. Preflight CORS requests consist of an additional prior request using <code>OPTIONS</code> method to the server to get access permission before the actual request takes place. So, 2 requests per cross-domain request or each URL.</p>

<h3>Microsoft.AspNet.WebApi.Cors</h3>

<p>As you might have guessed from the sub-title above, it is a CORS framework for WebAPI widely available through <a href="https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Cors">NuGet</a> to be referenced in your WebAPI application. It is as easy as enabling it on your <code>WebApiConfig.cs</code> file:</p>

<pre><code class="csharp">public static class WebApiConfig
{
  public static void Register(HttpConfiguration config)
  {
    // Enable Cors
    config.EnableCors();

    //...Routes
  }
}
</code></pre>

<p>Then decorate whatever controller which you want Cors support like below with whatever config you prefer. The following allows cors for all origins, headers and methods:</p>

<pre><code class="csharp">[EnableCors(origins: "*", headers: "*", methods: "*")]
public class TestController : ApiController 
{
    [HttpPost]
    public HttpResponseMessage Post()
    { }
}
</code></pre>

<p>More info can be found <a href="http://www.asp.net/web-api/overview/security/enabling-cross-origin-requests-in-web-api">here</a> on how to fully use this tool.</p>

<p>So, you have no worries about making your APIs cross-domain compliant now and have more control over accessibility. But few things to watch out like when making a <code>PUT</code> or <code>DELETE</code> request which is eligible for a Preflight CORS request and uses <code>OPTIONS</code> method (recall from earlier), you might have your controller set to accept only obvious HTTP methods like <code>POST</code> or <code>GET</code> which will fail the request because you had not allowed <code>OPTIONS</code> to get through.</p>

<p>This post is a summary of my learnings when I was stuck with handling cross-domain request (Preflight) in WebAPI. Hope it will help someone and comment below for any help.</p>

	</section>

  <footer class="post-footer">
  <section class="author">
    <h4>Ibrahim Islam</h4>
    <p></p>
  </section>
  <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?text=Cross-Domain With WebAPI&amp;url=http://ibrahim-islam.github.io/blog/2016/01/30/cross-domain-with-webapi/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://ibrahim-islam.github.io/blog/2016/01/30/cross-domain-with-webapi/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://ibrahim-islam.github.io/blog/2016/01/30/cross-domain-with-webapi/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
    </a>
  </section>
</footer>
  <hr>
  
    <div class="share">
</div>

  
  
  <section id="comment">
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>
  
</article></main>
  <footer class="site-footer"><a class="subscribe icon-feed" href="http://ibrahim-islam.github.io/atom.xml"><span class="tooltip">Subscribe!</span></a>


<div class="inner">









<section class="copyright">All content copyright <a href="/">Ibrahim Islam</a> © 2016 • All rights reserved.</section>

<section class="poweredby">Casper theme by <a class="icon-ghost" href="http://tryghost.org">Ghost</a> &amp; Published with <a href="http://octopress.org">Octopress</a></section>

</div>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>



<script type="text/javascript">
      var disqus_shortname = 'ibrahimsblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ibrahim-islam.github.io/blog/2016/01/30/cross-domain-with-webapi/';
        var disqus_url = 'http://ibrahim-islam.github.io/blog/2016/01/30/cross-domain-with-webapi/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
